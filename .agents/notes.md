[0] `tsx` CLI can fail in restricted macOS sandboxes with `listen EPERM` on `.../tsx-*/.pipe`; using `node --import tsx ...` avoids the IPC pipe path.
[0] `rrule` should be imported as a default object in runtime-executed TS/ESM paths here (`import rrule from 'rrule'`), then accessed as `rrule.rrulestr(...)`.
[0] `pnpm dev` port-binding failures like `listen EPERM` on `0.0.0.0:5173`/`:8787` can come from sandbox networking restrictions, not app code regressions.
[0] For nested apps, Vite reads `.env` from the app directory unless `envDir` is set; use workspace-root `envDir` when shared root env vars are expected.
[0] Drizzle SQLite schema callbacks should return an array in `sqliteTable` third argument (not an object map) to avoid deprecation warnings.
[0] Long-running CLI service orchestration should live outside the data-command `run(...)` wrapper so help-only calls keep migration laziness and process signals can be managed explicitly.
[1] In this pnpm workspace, global linking should target the package directory explicitly (`pnpm link --global ./apps/cli`); linking root can select `tithe` (no bins). zsh may need `exec zsh` or `hash -r`, and missing `PNPM_HOME` on `PATH` can still cause `command not found`.
[1] `tithe web` should preserve configured `VITE_API_BASE` by default (for remote/Tailnet clients) and only rewrite port when `--api-port` is explicitly set; always forcing localhost breaks mobile/remote dev access.
[0] Root `pnpm dev` may need a local-safe `VITE_API_BASE` override because `.env` often carries Tailnet/mobile values; defaulting `pnpm dev` to `127.0.0.1:8787` avoids loading hangs in local browser workflows.
[1] `@fastify/swagger` only captures routes after the plugin is registered; declare routes in plugins registered after Swagger (or inside `app.after(...)`) or OpenAPI docs at `/docs`/`/docs/json` will show no operations.
[0] With Fastify plugin prefixes, use an empty local route path (`''`) for collection roots; using `'/'` yields OpenAPI paths with trailing slashes (e.g. `/v1/categories/`).
[1] In zsh shell commands, unescaped backticks or unbalanced quote characters in search patterns break parsing; quote or escape `rg` patterns carefully.
[0] Fastify schema validation errors reach `setErrorHandler`; if not mapped explicitly, they can be wrapped as generic 500s and break envelope contracts.
[0] In Drizzle with better-sqlite3, transaction callbacks are synchronous; repository methods used inside transactions should execute queries explicitly with `.run()`/`.all()`/`.get()` instead of relying on awaited query builders.
[0] In this workspace, downstream package typechecks may read dependency declarations from built `dist` outputs; after API-surface changes, build producer packages (`@tithe/domain`, `@tithe/api`) before consumer typechecks, and avoid parallelizing those steps.
[0] In restricted/offline sessions, `pnpm install` can fail with registry DNS errors; avoid introducing new dependency links that require install, and prefer local source wiring plus package builds.
[0] `pnpm install --offline` may recreate/remove `node_modules` before failing if the local pnpm store is incomplete (for example missing tarballs); avoid running it mid-task unless cache completeness is confirmed.
[1] `biome format --write` may not resolve `organizeImports` lint issues; reorder imports manually (or run an imports-aware fix step) when lint still fails after formatting.
[0] `pnpm --filter <pkg> ...` scripts may run with package-local CWD, so `.env` autoload must resolve workspace-root path explicitly instead of relying on default `process.loadEnvFile()` behavior.
[0] `dotenv@17` can print an injection banner by default; set `quiet: true` in `dotenv.config(...)` to preserve deterministic `--json` CLI output.
[0] Fastify rejects requests with `FST_ERR_CTP_EMPTY_JSON_BODY` when `Content-Type: application/json` is sent on empty-body POSTs; frontend should only set JSON content-type when a body exists.
[0] Monzo can return `forbidden.insufficient_permissions` on `/accounts`; map it to `MONZO_REAUTH_REQUIRED` with clear remediation and avoid hard-coding stored OAuth scope.
[0] `pnpm ignored-builds` can reveal `better-sqlite3` was auto-ignored during install; deleting `node_modules`/lockfile alone won't fix missing bindings unless pnpm build-script policy is updated (for example `pnpm.onlyBuiltDependencies`) and install/rebuild is rerun.
[0] Avoid naming repo scripts `setup` in pnpm workspaces when onboarding docs also reference the built-in `pnpm setup`; use a distinct name like `setup:first-time` to prevent command ambiguity.
[0] In React page components here, hooks (`useMemo`, etc.) must be declared before loading/error early returns; conditionally skipping a hook on the first render causes a blank route via hooks-order runtime crash (`Rendered more hooks than during the previous render`).
[0] `DB_PATH` values using a leading `~` need explicit home-directory expansion in Node path resolution (`path.resolve` treats `~` as a literal path segment); keep README/.env defaults in sync with runtime defaults.
[0] PWA Monzo `Sync now` uses the shared 10s request timeout and only invalidates Monzo status on success; a slow/failed sync can show a mutation error while backend status/`lastError` stays stale in the card until a later refetch.
[0] In patch/merge helpers for nullable fields, avoid `??` when explicit `null` is a valid "clear this value" update (for example Monzo connection `lastErrorText`/OAuth state); use `value === undefined ? fallback : value`.
[0] Do not auto-run Monzo sync from OAuth callback: Monzo app permission approval can lag token exchange, so callback-time sync often fails with temporary permission errors; connect should store tokens and require manual `Sync now`.
[0] Monzo `/transactions` paging code must not assume descending order by `created`; if results come back ascending, `before=oldest-1` fetches only the oldest page in the window (symptom: first sync tops out around early-window dates like Dec 2 instead of today).
[2] In `@tithe/tests`, `pnpm --filter @tithe/tests test -- <files>` may still execute the full Vitest suite via the package script; use `pnpm --filter @tithe/tests exec vitest run ...` for targeted files, and pass paths relative to the `tests/` package root (for example `domain/monzo.spec.ts`).
[0] Monzo sync behavior in `packages/domain/src/services/monzo.service.ts` uses the local domain client (`packages/domain/src/services/monzo-client.ts`), not `packages/integrations-monzo`, so API-field additions for sync must be implemented in the domain client too.
[0] In `apps/pwa/src/features/<feature>`, files at the feature root import shared `src/*` modules with `../../...`, while nested `components/`/`dialogs/`/`hooks/` files need `../../../...`; it's easy to overshoot by one level when splitting a large page.
[0] `biome check src` currently reports a `useExhaustiveDependencies` warning in `apps/pwa/src/pages/ExpensesPage.tsx` for the avatar `useEffect` dependency on `merchantLogoUrl`; this appears pre-existing and can block full PWA lint even when the Home refactor files are clean.
[0] `@tithe/tests` API route specs import `@tithe/api/server` from built package output, so route/contract changes in `apps/api/src` may not show up until `pnpm --filter @tithe/domain build` and `pnpm --filter @tithe/api build` are rerun.
[0] When planning Ledger v2 migrations for this repo, confirm rollout expectations first: if the user is resetting the non-production local DB, remove backfill work entirely and prefer simple additive/drop-recreate migrations (especially for table-shape changes like Monzo category mappings).
[0] In Fastify query schemas with coercion enabled, `dryRun=true` can match both boolean and string branches; using `oneOf` for `dryRun` (`boolean` + `'true'|'false'|'1'|'0'`) may fail validation with "must match exactly one schema". Use `anyOf` (or a single normalized schema) for approval-flow query params.
[0] When refactoring PWA React pages/components in this repo and a React best-practices skill is available (for example `vercel-react-best-practices`), load and apply it before making UI changes; the user explicitly expects skill usage, not just local reasoning.
